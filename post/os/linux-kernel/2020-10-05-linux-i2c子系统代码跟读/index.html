<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>I2C子系统代码跟读 - Yuanye Ma's Blog
</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="Yuanye Ma"><meta name=description content="Linux内核 I2C子系统代码跟读 听了这个课程感觉讲的很好，很有必要自己跟读一遍Kernel中I2C的代码，以加深对Kernel中I2C子系"><meta name=keywords content="Hugo,theme,jane"><meta name=generator content="Hugo 0.126.1"><link rel=canonical href=/post/os/linux-kernel/2020-10-05-linux-i2c%E5%AD%90%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%A0%81%E8%B7%9F%E8%AF%BB/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/sass/jane.min.e826e860368147e5a6685e686355e4d7789023c18c9ea2e78b35f6786ce92736.css integrity="sha256-6CboYDaBR+WmaF5oY1Xk13iQI8GMnqLnizX2eGzpJzY=" media=screen crossorigin=anonymous><meta property="og:url" content="/post/os/linux-kernel/2020-10-05-linux-i2c%E5%AD%90%E7%B3%BB%E7%BB%9F%E4%BB%A3%E7%A0%81%E8%B7%9F%E8%AF%BB/"><meta property="og:site_name" content="Yuanye Ma's Blog"><meta property="og:title" content="I2C子系统代码跟读"><meta property="og:description" content="Linux内核 I2C子系统代码跟读 听了这个课程感觉讲的很好，很有必要自己跟读一遍Kernel中I2C的代码，以加深对Kernel中I2C子系"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-10-05T16:01:23+08:00"><meta property="article:modified_time" content="2020-10-05T16:01:23+08:00"><meta property="article:tag" content="Kernel Driver"><meta property="article:tag" content="I2c子系统"><meta itemprop=name content="I2C子系统代码跟读"><meta itemprop=description content="Linux内核 I2C子系统代码跟读 听了这个课程感觉讲的很好，很有必要自己跟读一遍Kernel中I2C的代码，以加深对Kernel中I2C子系"><meta itemprop=datePublished content="2020-10-05T16:01:23+08:00"><meta itemprop=dateModified content="2020-10-05T16:01:23+08:00"><meta itemprop=wordCount content="3721"><meta itemprop=keywords content="Kernel Driver,I2c子系统"><meta name=twitter:card content="summary"><meta name=twitter:title content="I2C子系统代码跟读"><meta name=twitter:description content="Linux内核 I2C子系统代码跟读 听了这个课程感觉讲的很好，很有必要自己跟读一遍Kernel中I2C的代码，以加深对Kernel中I2C子系"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=back-to-top></div><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>功不唐捐</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=/>Home</a></li><li class=mobile-menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=mobile-menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=mobile-menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=mobile-menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav><link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css><link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>功不唐捐</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight wallpaper"><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>I2C子系统代码跟读</h1><div class=post-meta><div class=post-meta-author>by
<a href=/about><span class=post-meta-author-name>Yuanye Ma</span></a></div><div class=post-meta-time><time datetime=2020-10-05>2020-10-05</time></div><div class=post-meta__right><div class=post-meta-category><a href=/categories/linux-kernel/>Linux Kernel</a></div></div></div></header><div class=post-content><h1 id=linux内核-i2c子系统代码跟读>Linux内核 I2C子系统代码跟读</h1><p><a href=https://www.bilibili.com/video/BV1CK411N7dB>听了这个课程</a>感觉讲的很好，很有必要自己跟读一遍Kernel中I2C的代码，以加深对Kernel中I2C子系统的理解。</p><h1 id=相关文件>相关文件</h1><blockquote><p>mach-smdkv210.c ： 开机注册方法</p><p>at24_drv.c ： 设备驱动层</p><p>i2c-core.c ： i2c总线核心层</p><p>i2c-s3c2410.c ： i2c_adapter驱动层（i2c控制器驱动层）</p></blockquote><h1 id=设备注册>设备注册</h1><div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-56>56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-57>57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-58>58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-59>59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-60>60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-61>61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-62>62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-63>63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-64>64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-65>65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-66>66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-67>67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-68>68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-69>69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-70>70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-71>71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-72>72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-73>73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-74>74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-75>75</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-76>76</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-77>77</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-78><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-78>78</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-79><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-79>79</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>// mach-smdkv210.c
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span><span style=color:#007020;font-weight:700>static</span> <span style=color:#007020;font-weight:700>struct</span> i2c_board_info smdkv210_i2c_devs0[] __initdata <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>    { <span style=color:#06287e>I2C_BOARD_INFO</span>(<span style=color:#4070a0>&#34;24c08&#34;</span>, <span style=color:#40a070>0x50</span>), },     
</span></span><span style=display:flex><span>    { <span style=color:#06287e>I2C_BOARD_INFO</span>(<span style=color:#4070a0>&#34;wm8580&#34;</span>, <span style=color:#40a070>0x1b</span>), },
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#007020>#define ARRAY_SIZE(x) (sizeof(x) / sizeof((x)[0])) </span><span style=color:#60a0b0;font-style:italic>//求数组中元素个数
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span><span style=color:#007020>#define I2C_BOARD_INFO(dev_type, dev_addr) .type = dev_type, .addr = (dev_addr) 
</span></span></span><span style=display:flex><span><span style=color:#007020></span>
</span></span><span style=display:flex><span>smdkv210_machine_init 
</span></span><span style=display:flex><span>	<span style=color:#666>|</span>
</span></span><span style=display:flex><span>	<span style=color:#06287e>i2c_register_board_info</span>(<span style=color:#40a070>0</span>, smdkv210_i2c_devs0,<span style=color:#06287e>ARRAY_SIZE</span>(smdkv210_i2c_devs0));
</span></span><span style=display:flex><span>		<span style=color:#666>|</span>
</span></span><span style=display:flex><span>		<span style=color:#902000>int</span> <span style=color:#06287e>i2c_register_board_info</span>(<span style=color:#902000>int</span> busnum,<span style=color:#007020;font-weight:700>struct</span> i2c_board_info <span style=color:#007020;font-weight:700>const</span> <span style=color:#666>*</span>info, <span style=color:#902000>unsigned</span> len)
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#007020;font-weight:700>for</span> (status <span style=color:#666>=</span> <span style=color:#40a070>0</span>; len; len<span style=color:#666>--</span>, info<span style=color:#666>++</span>) {
</span></span><span style=display:flex><span>				<span style=color:#007020;font-weight:700>struct</span> i2c_devinfo	<span style=color:#666>*</span>devinfo;
</span></span><span style=display:flex><span>                <span style=color:#60a0b0;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                	struct i2c_devinfo {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                        struct list_head	list;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                        int			busnum;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                        struct i2c_board_info	board_info;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    };
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                */</span>
</span></span><span style=display:flex><span>				devinfo <span style=color:#666>=</span> <span style=color:#06287e>kzalloc</span>(<span style=color:#007020;font-weight:700>sizeof</span>(<span style=color:#666>*</span>devinfo), GFP_KERNEL);
</span></span><span style=display:flex><span>				devinfo<span style=color:#666>-&gt;</span>busnum <span style=color:#666>=</span> busnum;
</span></span><span style=display:flex><span>				devinfo<span style=color:#666>-&gt;</span>board_info <span style=color:#666>=</span> <span style=color:#666>*</span>info;
</span></span><span style=display:flex><span>				<span style=color:#06287e>list_add_tail</span>(<span style=color:#666>&amp;</span>devinfo<span style=color:#666>-&gt;</span>list, <span style=color:#666>&amp;</span>__i2c_board_list);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#60a0b0;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>			总结： i2c_register_board_info()函数构造了一个链表__i2c_board_list，并将i2c的board_info加入此链表，并加入了控制器编号。
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>		*/</span>
</span></span><span style=display:flex><span>	<span style=color:#06287e>i2c_register_board_info</span>(<span style=color:#40a070>1</span>, smdkv210_i2c_devs1,<span style=color:#06287e>ARRAY_SIZE</span>(smdkv210_i2c_devs1));
</span></span><span style=display:flex><span>	<span style=color:#06287e>i2c_register_board_info</span>(<span style=color:#40a070>2</span>, smdkv210_i2c_devs2,<span style=color:#06287e>ARRAY_SIZE</span>(smdkv210_i2c_devs2));
</span></span><span style=display:flex><span>	<span style=color:#06287e>platform_add_devices</span>(smdkv210_devices, <span style=color:#06287e>ARRAY_SIZE</span>(smdkv210_devices));
</span></span><span style=display:flex><span>        <span style=color:#60a0b0;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>            static struct platform_device *smdkv210_devices[] __initdata = {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                &amp;s3c_device_i2c0,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                &amp;s3c_device_i2c1,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                &amp;s3c_device_i2c2,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>            };
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>            struct platform_device s3c_device_i2c0 = {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>				.name		  = &#34;s3c2410-i2c&#34;,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>				.id		  = 0,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>				.num_resources	  = ARRAY_SIZE(s3c_i2c_resource),
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>				.resource	  = s3c_i2c_resource,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>			};
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>			static struct resource s3c_i2c_resource[] = {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>            [0] = {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                .start	= S3C_PA_IIC5,	// #define S3C_PA_IIC5			EXYNOS4_PA_IIC(5)
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                .end	= S3C_PA_IIC5 + SZ_4K - 1,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                .flags	= IORESOURCE_MEM,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>            },
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>            [1] = {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                .start	= IRQ_IIC5,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                .end	= IRQ_IIC5,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                .flags	= IORESOURCE_IRQ,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>            },
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>        };
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>        */</span>
</span></span><span style=display:flex><span>		<span style=color:#666>|</span>
</span></span><span style=display:flex><span>        <span style=color:#902000>int</span> <span style=color:#06287e>platform_add_devices</span>(<span style=color:#007020;font-weight:700>struct</span> platform_device <span style=color:#666>**</span>devs, <span style=color:#902000>int</span> num)
</span></span><span style=display:flex><span>            <span style=color:#007020;font-weight:700>for</span> (i <span style=color:#666>=</span> <span style=color:#40a070>0</span>; i <span style=color:#666>&lt;</span> num; i<span style=color:#666>++</span>) 
</span></span><span style=display:flex><span>                ret <span style=color:#666>=</span> <span style=color:#06287e>platform_device_register</span>(devs[i]);
</span></span><span style=display:flex><span>            			<span style=color:#666>|</span>
</span></span><span style=display:flex><span>                        <span style=color:#06287e>platform_device_add</span>() <span style=color:#60a0b0;font-style:italic>//此函数定义在drivers/base/platform.c中
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>                            <span style=color:#666>|</span>
</span></span><span style=display:flex><span>                            pdev<span style=color:#666>-&gt;</span>dev.bus <span style=color:#666>=</span> <span style=color:#666>&amp;</span>platform_bus_type;
</span></span><span style=display:flex><span>								<span style=color:#666>|</span>
</span></span><span style=display:flex><span>                                <span style=color:#007020;font-weight:700>struct</span> bus_type platform_bus_type <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>                                    .name		<span style=color:#666>=</span> <span style=color:#4070a0>&#34;platform&#34;</span>,
</span></span><span style=display:flex><span>                                    .match		<span style=color:#666>=</span> platform_match,
</span></span><span style=display:flex><span>                                };
</span></span><span style=display:flex><span>                            <span style=color:#06287e>device_add</span>(<span style=color:#666>&amp;</span>pdev<span style=color:#666>-&gt;</span>dev); <span style=color:#60a0b0;font-style:italic>//此函数定义在drivers/base/core.c
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>
</span></span><span style=display:flex><span>        <span style=color:#60a0b0;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>        	总结：
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>        		此函数向platform平台中批量注册platform_device, i2c控制器也抽象为platform_device，并包含寄存器地址信息。
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>        */</span>
</span></span></code></pre></td></tr></table></div></div><p>向platform中注册设备属于另外一篇文章，此处不再深究。</p><h1 id=i2c总线核心驱动层>i2c总线核心驱动层</h1><div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-25>25</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>//i2c-core.c (drivers/i2c/i2c-core.c)
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span><span style=color:#06287e>postcore_initcall</span>(i2c_init);
</span></span><span style=display:flex><span><span style=color:#06287e>module_exit</span>(i2c_exit);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>static</span> <span style=color:#902000>int</span> __init <span style=color:#06287e>i2c_init</span>(<span style=color:#902000>void</span>)
</span></span><span style=display:flex><span>    <span style=color:#666>|</span>
</span></span><span style=display:flex><span>	<span style=color:#06287e>bus_register</span>(<span style=color:#666>&amp;</span>i2c_bus_type); <span style=color:#60a0b0;font-style:italic>// 构建了i2c总线，并定义了匹配的方法
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>		<span style=color:#60a0b0;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>			struct bus_type i2c_bus_type = {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                .name		= &#34;i2c&#34;,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                .match		= i2c_device_match,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                .probe		= i2c_device_probe,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                .remove		= i2c_device_remove,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>            };
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>		*/</span>
</span></span><span style=display:flex><span>		<span style=color:#666>|</span>
</span></span><span style=display:flex><span>		<span style=color:#06287e>i2c_add_driver</span>(<span style=color:#666>&amp;</span>dummy_driver); <span style=color:#60a0b0;font-style:italic>//只增加了一个设备
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>static</span> <span style=color:#902000>void</span> __exit <span style=color:#06287e>i2c_exit</span>(<span style=color:#902000>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#06287e>i2c_del_driver</span>(<span style=color:#666>&amp;</span>dummy_driver);
</span></span><span style=display:flex><span>	<span style=color:#06287e>bus_unregister</span>(<span style=color:#666>&amp;</span>i2c_bus_type);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h1 id=i2c-adapter层>i2c adapter层</h1><div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>  1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2>  2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-3>  3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-4>  4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-5>  5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-6>  6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-7>  7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-8>  8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-9>  9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-10> 10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-11> 11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-12> 12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-13> 13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-14> 14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-15> 15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-16> 16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-17> 17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-18> 18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-19> 19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-20> 20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-21> 21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-22> 22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-23> 23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-24> 24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-25> 25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-26> 26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-27> 27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-28> 28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-29> 29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-30> 30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-31> 31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-32> 32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-33> 33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-34> 34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-35> 35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-36> 36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-37> 37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-38> 38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-39> 39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-40> 40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-41> 41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-42> 42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-43> 43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-44> 44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-45> 45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-46> 46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-47> 47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-48> 48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-49> 49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-50> 50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-51> 51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-52> 52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-53> 53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-54> 54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-55> 55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-56> 56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-57> 57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-58> 58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-59> 59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-60> 60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-61> 61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-62> 62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-63> 63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-64> 64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-65> 65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-66> 66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-67> 67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-68> 68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-69> 69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-70> 70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-71> 71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-72> 72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-73> 73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-74> 74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-75> 75</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-76> 76</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-77> 77</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-78><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-78> 78</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-79><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-79> 79</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-80><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-80> 80</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-81><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-81> 81</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-82><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-82> 82</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-83><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-83> 83</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-84><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-84> 84</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-85><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-85> 85</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-86><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-86> 86</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-87><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-87> 87</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-88><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-88> 88</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-89><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-89> 89</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-90><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-90> 90</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-91><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-91> 91</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-92><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-92> 92</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-93><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-93> 93</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-94><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-94> 94</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-95><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-95> 95</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-96><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-96> 96</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-97><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-97> 97</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-98><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-98> 98</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-99><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-99> 99</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-100><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-100>100</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-101><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-101>101</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-102><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-102>102</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-103><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-103>103</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-104><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-104>104</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-105><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-105>105</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-106><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-106>106</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-107><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-107>107</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-108><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-108>108</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-109><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-109>109</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-110><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-110>110</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-111><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-111>111</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-112><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-112>112</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-113><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-113>113</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-114><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-114>114</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-115><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-115>115</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-116><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-116>116</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-117><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-117>117</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-118><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-118>118</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-119><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-119>119</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-120><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-120>120</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-121><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-121>121</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-122><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-122>122</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-123><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-123>123</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-124><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-124>124</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-125><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-125>125</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-126><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-126>126</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-127><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-127>127</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-128><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-128>128</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-129><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-129>129</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-130><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-130>130</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-131><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-131>131</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-132><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-132>132</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-133><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-133>133</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>// i2c-s3c2410.c (drivers/i2c/busses/i2c-s3c2410.c)
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#06287e>i2c_adap_s3c_init</span>()
</span></span><span style=display:flex><span>    <span style=color:#666>|</span>
</span></span><span style=display:flex><span>    <span style=color:#06287e>platform_driver_register</span>(<span style=color:#666>&amp;</span>s3c24xx_i2c_driver) <span style=color:#60a0b0;font-style:italic>// 向platform总线注册了platform_driver
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>            <span style=color:#007020;font-weight:700>static</span> <span style=color:#007020;font-weight:700>struct</span> platform_driver s3c24xx_i2c_driver <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>                .probe		<span style=color:#666>=</span> s3c24xx_i2c_probe,
</span></span><span style=display:flex><span>                .id_table	<span style=color:#666>=</span> s3c24xx_driver_ids,
</span></span><span style=display:flex><span>                .driver		<span style=color:#666>=</span> {
</span></span><span style=display:flex><span>                    .name	<span style=color:#666>=</span> <span style=color:#4070a0>&#34;s3c-i2c&#34;</span>,
</span></span><span style=display:flex><span>                },
</span></span><span style=display:flex><span>            };
</span></span><span style=display:flex><span>					<span style=color:#60a0b0;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>						其中
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>							static struct platform_device_id s3c24xx_driver_ids[] = {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                            {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                .name		= &#34;s3c2410-i2c&#34;,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                .driver_data	= TYPE_S3C2410,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                            }, {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                .name		= &#34;s3c2440-i2c&#34;,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                .driver_data	= TYPE_S3C2440,
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                            }, { },
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                        };
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>					*/</span>
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>// platform_driver注册进platform总线后会调用platform的match函数，匹配成功后会调用platform_driver的probe函数，匹配的过程这里暂时不分析，先看probe函数的内容。
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#06287e>s3c24xx_i2c_probe</span>(<span style=color:#007020;font-weight:700>struct</span> platform_device <span style=color:#666>*</span>pdev)
</span></span><span style=display:flex><span>    <span style=color:#666>|</span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>struct</span> s3c24xx_i2c <span style=color:#666>*</span>i2c;
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> s3c2410_platform_i2c <span style=color:#666>*</span>pdata;
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> resource <span style=color:#666>*</span>res;
</span></span><span style=display:flex><span>	pdata <span style=color:#666>=</span> pdev<span style=color:#666>-&gt;</span>dev.platform_data; <span style=color:#60a0b0;font-style:italic>// 获取到平台自定义数据
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>
</span></span><span style=display:flex><span>	i2c <span style=color:#666>=</span> <span style=color:#06287e>kzalloc</span>(<span style=color:#007020;font-weight:700>sizeof</span>(<span style=color:#007020;font-weight:700>struct</span> s3c24xx_i2c), GFP_KERNEL); <span style=color:#60a0b0;font-style:italic>// 分配一个adapter
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>			<span style=color:#60a0b0;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                struct s3c24xx_i2c {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    struct i2c_msg		*msg;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    unsigned int		irq;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    void __iomem		*regs;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    struct device		*dev;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    struct resource		*ioarea;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    struct i2c_adapter	adap;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                };
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                struct i2c_adapter {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    struct module *owner; 
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    const struct i2c_algorithm *algo; 
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    void *algo_data;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    struct device dev;		
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    int nr;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                    char name[48];
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                }
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>			*/</span>
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>/* 初始化adapter */</span>
</span></span><span style=display:flex><span>	<span style=color:#06287e>strlcpy</span>(i2c<span style=color:#666>-&gt;</span>adap.name, <span style=color:#4070a0>&#34;s3c2410-i2c&#34;</span>, <span style=color:#007020;font-weight:700>sizeof</span>(i2c<span style=color:#666>-&gt;</span>adap.name));
</span></span><span style=display:flex><span>	i2c<span style=color:#666>-&gt;</span>adap.owner   <span style=color:#666>=</span> THIS_MODULE;
</span></span><span style=display:flex><span>	i2c<span style=color:#666>-&gt;</span>adap.algo    <span style=color:#666>=</span> <span style=color:#666>&amp;</span>s3c24xx_i2c_algorithm;
</span></span><span style=display:flex><span>	i2c<span style=color:#666>-&gt;</span>dev <span style=color:#666>=</span> <span style=color:#666>&amp;</span>pdev<span style=color:#666>-&gt;</span>dev;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>/* 获得内存资源 */</span>
</span></span><span style=display:flex><span>	<span style=color:#06287e>platform_get_resource</span>(pdev, IORESOURCE_MEM, <span style=color:#40a070>0</span>);
</span></span><span style=display:flex><span>	i2c<span style=color:#666>-&gt;</span>regs <span style=color:#666>=</span> <span style=color:#06287e>ioremap</span>(res<span style=color:#666>-&gt;</span>start, <span style=color:#06287e>resource_size</span>(res));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	i2c<span style=color:#666>-&gt;</span>adap.algo_data <span style=color:#666>=</span> i2c;
</span></span><span style=display:flex><span>	i2c<span style=color:#666>-&gt;</span>adap.dev.parent <span style=color:#666>=</span> <span style=color:#666>&amp;</span>pdev<span style=color:#666>-&gt;</span>dev;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#06287e>s3c24xx_i2c_init</span>(i2c);  <span style=color:#60a0b0;font-style:italic>// 硬件初始化
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>/* 获得中断资源 */</span>
</span></span><span style=display:flex><span>	i2c<span style=color:#666>-&gt;</span>irq <span style=color:#666>=</span> <span style=color:#06287e>platform_get_irq</span>(pdev, <span style=color:#40a070>0</span>);
</span></span><span style=display:flex><span>	<span style=color:#06287e>request_irq</span>(i2c<span style=color:#666>-&gt;</span>irq, s3c24xx_i2c_irq, IRQF_DISABLED, <span style=color:#06287e>dev_name</span>(<span style=color:#666>&amp;</span>pdev<span style=color:#666>-&gt;</span>dev), i2c);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	i2c<span style=color:#666>-&gt;</span>adap.nr <span style=color:#666>=</span> pdata<span style=color:#666>-&gt;</span>bus_num;
</span></span><span style=display:flex><span>	<span style=color:#06287e>i2c_add_numbered_adapter</span>(<span style=color:#666>&amp;</span>i2c<span style=color:#666>-&gt;</span>adap);  <span style=color:#60a0b0;font-style:italic>// i2c-core.c
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>		<span style=color:#007020;font-weight:700>static</span> <span style=color:#902000>int</span> <span style=color:#06287e>i2c_register_adapter</span>(<span style=color:#007020;font-weight:700>struct</span> i2c_adapter <span style=color:#666>*</span>adap)
</span></span><span style=display:flex><span>		<span style=color:#666>|</span>
</span></span><span style=display:flex><span>        <span style=color:#06287e>i2c_register_adapter</span>(adap);
</span></span><span style=display:flex><span>			<span style=color:#666>|</span>
</span></span><span style=display:flex><span>	        <span style=color:#06287e>dev_set_name</span>(<span style=color:#666>&amp;</span>adap<span style=color:#666>-&gt;</span>dev, <span style=color:#4070a0>&#34;i2c-%d&#34;</span>, adap<span style=color:#666>-&gt;</span>nr); <span style=color:#60a0b0;font-style:italic>// 设备名字 i2c-控制器序号
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>    	    adap<span style=color:#666>-&gt;</span>dev.bus <span style=color:#666>=</span> <span style=color:#666>&amp;</span>i2c_bus_type;
</span></span><span style=display:flex><span>        	adap<span style=color:#666>-&gt;</span>dev.type <span style=color:#666>=</span> <span style=color:#666>&amp;</span>i2c_adapter_type;
</span></span><span style=display:flex><span>	        res <span style=color:#666>=</span> <span style=color:#06287e>device_register</span>(<span style=color:#666>&amp;</span>adap<span style=color:#666>-&gt;</span>dev);
</span></span><span style=display:flex><span>			<span style=color:#06287e>i2c_scan_static_board_info</span>(adap);
</span></span><span style=display:flex><span>				<span style=color:#007020;font-weight:700>static</span> <span style=color:#902000>void</span> <span style=color:#06287e>i2c_scan_static_board_info</span>(<span style=color:#007020;font-weight:700>struct</span> i2c_adapter <span style=color:#666>*</span>adapter)
</span></span><span style=display:flex><span>                    <span style=color:#007020;font-weight:700>struct</span> i2c_devinfo	<span style=color:#666>*</span>devinfo;
</span></span><span style=display:flex><span>				<span style=color:#666>|</span>
</span></span><span style=display:flex><span>                <span style=color:#06287e>list_for_each_entry</span>(devinfo, <span style=color:#666>&amp;</span>__i2c_board_list, list) {
</span></span><span style=display:flex><span>                    <span style=color:#007020;font-weight:700>if</span> (devinfo<span style=color:#666>-&gt;</span>busnum <span style=color:#666>==</span> adapter<span style=color:#666>-&gt;</span>nr
</span></span><span style=display:flex><span>                        <span style=color:#666>&amp;&amp;</span> <span style=color:#666>!</span><span style=color:#06287e>i2c_new_device</span>(adapter, <span style=color:#666>&amp;</span>devinfo<span style=color:#666>-&gt;</span>board_info))
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>						<span style=color:#666>|</span>
</span></span><span style=display:flex><span>                        <span style=color:#007020;font-weight:700>struct</span> i2c_client <span style=color:#666>*</span> <span style=color:#06287e>i2c_new_device</span>(<span style=color:#007020;font-weight:700>struct</span> i2c_adapter <span style=color:#666>*</span>adap, <span style=color:#007020;font-weight:700>struct</span> i2c_board_info <span style=color:#007020;font-weight:700>const</span> <span style=color:#666>*</span>info)
</span></span><span style=display:flex><span>                            	<span style=color:#666>|</span>
</span></span><span style=display:flex><span>                            	<span style=color:#007020;font-weight:700>struct</span> i2c_client	<span style=color:#666>*</span>client;
</span></span><span style=display:flex><span>										<span style=color:#60a0b0;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>											struct i2c_client {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                unsigned short flags;		//传输方向
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                unsigned short addr;		//设备地址
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                char name[I2C_NAME_SIZE];
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                struct i2c_adapter *adapter;	//与之对应的适配器
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                struct i2c_driver *driver;	//父类
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                struct device dev;		//父类
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                        	};
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                        
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                            struct i2c_driver {
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                //Standard driver model interfaces 
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                int (*probe)(struct i2c_client *, const struct i2c_device_id *);
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                int (*remove)(struct i2c_client *);
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                struct device_driver driver;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                                const struct i2c_device_id *id_table;
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>                                            };
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>										*/</span>
</span></span><span style=display:flex><span>								client <span style=color:#666>=</span> <span style=color:#06287e>kzalloc</span>(<span style=color:#007020;font-weight:700>sizeof</span> <span style=color:#666>*</span>client, GFP_KERNEL);
</span></span><span style=display:flex><span>                                client<span style=color:#666>-&gt;</span>adapter <span style=color:#666>=</span> adap;
</span></span><span style=display:flex><span>                                client<span style=color:#666>-&gt;</span>dev.platform_data <span style=color:#666>=</span> info<span style=color:#666>-&gt;</span>platform_data;
</span></span><span style=display:flex><span>                                client<span style=color:#666>-&gt;</span>flags <span style=color:#666>=</span> info<span style=color:#666>-&gt;</span>flags;
</span></span><span style=display:flex><span>                                client<span style=color:#666>-&gt;</span>addr <span style=color:#666>=</span> info<span style=color:#666>-&gt;</span>addr;
</span></span><span style=display:flex><span>                                client<span style=color:#666>-&gt;</span>irq <span style=color:#666>=</span> info<span style=color:#666>-&gt;</span>irq;
</span></span><span style=display:flex><span>								<span style=color:#06287e>strlcpy</span>(client<span style=color:#666>-&gt;</span>name, info<span style=color:#666>-&gt;</span>type, <span style=color:#007020;font-weight:700>sizeof</span>(client<span style=color:#666>-&gt;</span>name));
</span></span><span style=display:flex><span>                                client<span style=color:#666>-&gt;</span>dev.parent <span style=color:#666>=</span> <span style=color:#666>&amp;</span>client<span style=color:#666>-&gt;</span>adapter<span style=color:#666>-&gt;</span>dev;
</span></span><span style=display:flex><span>                                client<span style=color:#666>-&gt;</span>dev.bus <span style=color:#666>=</span> <span style=color:#666>&amp;</span>i2c_bus_type;
</span></span><span style=display:flex><span>                                client<span style=color:#666>-&gt;</span>dev.type <span style=color:#666>=</span> <span style=color:#666>&amp;</span>i2c_client_type;
</span></span><span style=display:flex><span>                                <span style=color:#06287e>dev_set_name</span>(<span style=color:#666>&amp;</span>client<span style=color:#666>-&gt;</span>dev, <span style=color:#4070a0>&#34;%d-%04x&#34;</span>, <span style=color:#06287e>i2c_adapter_id</span>(adap), client<span style=color:#666>-&gt;</span>addr); <span style=color:#60a0b0;font-style:italic>// 0-0x50 0号控制器上的地址为0x50的从设备
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>                                <span style=color:#06287e>device_register</span>(<span style=color:#666>&amp;</span>client<span style=color:#666>-&gt;</span>dev);
</span></span><span style=display:flex><span>				<span style=color:#60a0b0;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>					总结:
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>						adapter在注册的时候,会遍历__i2c_board_list链表
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>						如果adapter的编号和链表中节点的号码一致,就会构建i2c client并注册client
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>						i2c client中成员的值来自于board_info
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>				*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#06287e>platform_set_drvdata</span>(pdev, i2c);
</span></span><span style=display:flex><span>         
</span></span></code></pre></td></tr></table></div></div><h1 id=设备驱动层>设备驱动层</h1><p>自己需要写的驱动代码</p><div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-17>17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-18>18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-19>19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-20>20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-21>21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-22>22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-23>23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-24>24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-25>25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-26>26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-27>27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-28>28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-29>29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-30>30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-31>31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-32>32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-33>33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-34>34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-35>35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-36>36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-37>37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-38>38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-39>39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-40>40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-41>41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-42>42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-43>43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-44>44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-45>45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-46>46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-47>47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-48>48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-49>49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-50>50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-51>51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-52>52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-53>53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-54>54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-55>55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-56>56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-57>57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-58>58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-59>59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-60>60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-61>61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-62>62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-63>63</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>const</span> <span style=color:#007020;font-weight:700>struct</span> file_operations at24_fops <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>    .read <span style=color:#666>=</span> at24_e2prom_read,
</span></span><span style=display:flex><span>    .write <span style=color:#666>=</span> at24_e2prom_write,
</span></span><span style=display:flex><span>    .open <span style=color:#666>=</span> at24_e2prom_open,
</span></span><span style=display:flex><span>    .release <span style=color:#666>=</span> at24_e2prom_close,
</span></span><span style=display:flex><span>}; 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#902000>int</span> <span style=color:#06287e>at24_drv_probe</span>(<span style=color:#007020;font-weight:700>struct</span> i2c_client <span style=color:#666>*</span> client, <span style=color:#007020;font-weight:700>const</span> <span style=color:#007020;font-weight:700>struct</span> i2c_device_id  <span style=color:#666>*</span> id)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>         	申请设备号
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>         	创建设备文件
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>         	硬件初始化
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>         	实现fops
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>         */</span>
</span></span><span style=display:flex><span>    at24_dev <span style=color:#666>=</span> <span style=color:#06287e>kzalloc</span>(<span style=color:#007020;font-weight:700>sizeof</span>(<span style=color:#007020;font-weight:700>struct</span> i2c_e2prom), GFP_KERNEL);
</span></span><span style=display:flex><span>    at24_dev<span style=color:#666>-&gt;</span>major <span style=color:#666>=</span> <span style=color:#06287e>register_chrdev</span>(<span style=color:#40a070>0</span>, <span style=color:#4070a0>&#34;at24_drv&#34;</span>, <span style=color:#666>&amp;</span>at24_fops);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    at24_dev<span style=color:#666>-&gt;</span>cls <span style=color:#666>=</span> <span style=color:#06287e>class_create</span>(THIS_MODULE, <span style=color:#4070a0>&#34;at24_cls&#34;</span>);
</span></span><span style=display:flex><span>    at24_dev<span style=color:#666>-&gt;</span>dev <span style=color:#666>=</span> <span style=color:#06287e>device_create</span>(at24_dev<span style=color:#666>-&gt;</span>cls, <span style=color:#007020>NULL</span>, \
</span></span><span style=display:flex><span>                                  <span style=color:#06287e>MKDEV</span>(at24_dev<span style=color:#666>-&gt;</span>major, <span style=color:#40a070>0</span>), <span style=color:#007020>NULL</span>, <span style=color:#4070a0>&#34;at24_e2prom&#34;</span> );
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic>/* 硬件初始化 e2prom上电就可以工作了，不需要初始化,其他设备初始化就是指定寄存器地址，写入指定值。
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>            i2c系统中为从设备传输数据的方法
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>         	 int i2c_master_send(const struct i2c_client *client, const char *buf, int count)
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>         	 int i2c_master_recv(const struct i2c_client *client, char *buf, int count)
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>         	 这两个函数都调用
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>         	 int i2c_transfer(struct i2c_adapter *adap, struct i2c_msg *msgs, int num)
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>         */</span>
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic>// 记录当前的client, 总线中匹配成功后发送过来的
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>    at24_dev<span style=color:#666>-&gt;</span>client <span style=color:#666>=</span> client;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#007020;font-weight:700>return</span> <span style=color:#40a070>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>const</span> <span style=color:#007020;font-weight:700>struct</span> i2c_device_id at24_id_table[] <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>    {<span style=color:#4070a0>&#34;at24c02&#34;</span>, <span style=color:#40a070>0x2222</span>},
</span></span><span style=display:flex><span>    {<span style=color:#4070a0>&#34;at24c04&#34;</span>, <span style=color:#40a070>0x3333</span>},
</span></span><span style=display:flex><span>    {<span style=color:#4070a0>&#34;at24c08&#34;</span>, <span style=color:#40a070>0x4444</span>},
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>struct</span> i2c_driver at24_drv <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>    .probe <span style=color:#666>=</span> at24_drv_probe,
</span></span><span style=display:flex><span>    .remove <span style=color:#666>=</span> at24_drv_remove,
</span></span><span style=display:flex><span>    .driver <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>        .name <span style=color:#666>=</span> <span style=color:#4070a0>&#34;at24_e2prom_drv&#34;</span>, <span style=color:#60a0b0;font-style:italic>//不会用于比对， /sys/bus/i2c/drivers/at24_e2prom_drv
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>    },
</span></span><span style=display:flex><span>    .id_table <span style=color:#666>=</span> at24_id_table,
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>static</span> <span style=color:#902000>int</span> __init <span style=color:#06287e>at24_drv_init</span>(<span style=color:#902000>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic>// 注册一个i2c driver
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>    <span style=color:#007020;font-weight:700>return</span> <span style=color:#06287e>i2c_add_driver</span>(<span style=color:#666>&amp;</span>at24_drv);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>static</span> <span style=color:#902000>void</span> __exit <span style=color:#06287e>at24_drv_exit</span>(<span style=color:#902000>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#06287e>i2c_del_driver</span>(<span style=color:#666>&amp;</span>at24_drv);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#06287e>module_init</span>(at24_drv_init);
</span></span><span style=display:flex><span><span style=color:#06287e>module_exit</span>(at24_drv_exit);
</span></span></code></pre></td></tr></table></div></div><h1 id=总结>总结</h1><ol><li><p>mach-smdkv210.c中的smdkv210_machine_init() 会在内核初始化时调用</p></li><li><p>smdkv210_machine_init()中</p><pre><code> a. 调用i2c_register_board_info()函数，初始化了一个保存有从设备名字和地址的链表__i2c_board_list；  
 b. 调用platform_add_devices()函数，将SOC的I2C控制器抽象为的 包含寄存器以及中断等硬件资源的platform_device 注册进了platform总线;  
</code></pre></li><li><p>i2c-core.c中调用i2c_init()函数，注册了I2C总线的实现（包括总线上设备和驱动的匹配方法match()等）(即bus_register(&amp;i2c_bus_type))</p></li><li><p>i2c-s3c2410.c 中i2c_adap_s3c_init()函数调用platform_driver_register(&amp;s3c24xx_i2c_driver)函数向platform总线注册了一个platform_driver对象；</p></li><li><p>4中注册platform_driver的操作会调用platform的match()方法，此方法按照所注册的platform_driver(即s3c24xx_i2c_driver)的id_table字段和platform_device(比如mach-smdkv210.c中的s3c_device_i2c0)的name字段进行匹配，如果匹配就调用相应platform_driver的probe()方法。</p></li><li><p>i2c-s3c2410.c 中s3c24xx_i2c_probe()方法</p><pre><code> a. 分配并初始化了对象struct s3c24xx_i2c， 此对象包含一个 struct i2c_adapter对象，以及I2C控制器需要的硬件资源；  
 b. 然后调用i2c-core.c中的i2c_register_adapter()函数，主要根据__i2c_board_list中的从设备信息创建client并和adapter相关联。  
</code></pre></li></ol><blockquote><p>驱动编写</p><p>​ at24_drv.c中是自己写的驱动代码，按照一般内核模块写法，自己构造i2c_driver对象，该对象包含probe()方法，该方法在总结3 i2c_init()函数中定义的i2c_bus_type对象的match()方法中匹配i2c_device和i2c_driver成功时被调用。</p><p>​ probe()方法完成设备号注册，fops对象定义，以及硬件初始化操作。</p></blockquote><h1 id=关于数据流>关于数据流</h1><p>​ <code>client->adapter->i2c_algorithm->master_xfer(client->adapter, msgs, num)</code></p><div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-2> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-3> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-4> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-5> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-6> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-7> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-8> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-9> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-10>10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-11>11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-12>12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-13>13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-14>14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-15>15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-16>16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-17>17</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#007020;font-weight:700>struct</span> i2c_algorithm {
</span></span><span style=display:flex><span>	<span style=color:#902000>int</span> (<span style=color:#666>*</span>master_xfer)(<span style=color:#007020;font-weight:700>struct</span> i2c_adapter <span style=color:#666>*</span>adap, <span style=color:#007020;font-weight:700>struct</span> i2c_msg <span style=color:#666>*</span>msgs,<span style=color:#902000>int</span> num);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>struct</span> i2c_msg {
</span></span><span style=display:flex><span>	__u16 addr;	<span style=color:#60a0b0;font-style:italic>/* slave address			*/</span>
</span></span><span style=display:flex><span>	__u16 flags;
</span></span><span style=display:flex><span><span style=color:#007020>#define I2C_M_TEN		0x0010	</span><span style=color:#60a0b0;font-style:italic>/* this is a ten bit chip address */</span><span style=color:#007020>
</span></span></span><span style=display:flex><span><span style=color:#007020>#define I2C_M_RD		0x0001	</span><span style=color:#60a0b0;font-style:italic>/* read data, from slave to master */</span><span style=color:#007020>
</span></span></span><span style=display:flex><span><span style=color:#007020>#define I2C_M_NOSTART		0x4000	</span><span style=color:#60a0b0;font-style:italic>/* if I2C_FUNC_PROTOCOL_MANGLING */</span><span style=color:#007020>
</span></span></span><span style=display:flex><span><span style=color:#007020>#define I2C_M_REV_DIR_ADDR	0x2000	</span><span style=color:#60a0b0;font-style:italic>/* if I2C_FUNC_PROTOCOL_MANGLING */</span><span style=color:#007020>
</span></span></span><span style=display:flex><span><span style=color:#007020>#define I2C_M_IGNORE_NAK	0x1000	</span><span style=color:#60a0b0;font-style:italic>/* if I2C_FUNC_PROTOCOL_MANGLING */</span><span style=color:#007020>
</span></span></span><span style=display:flex><span><span style=color:#007020>#define I2C_M_NO_RD_ACK		0x0800	</span><span style=color:#60a0b0;font-style:italic>/* if I2C_FUNC_PROTOCOL_MANGLING */</span><span style=color:#007020>
</span></span></span><span style=display:flex><span><span style=color:#007020>#define I2C_M_RECV_LEN		0x0400	</span><span style=color:#60a0b0;font-style:italic>/* length will be first received byte */</span><span style=color:#007020>
</span></span></span><span style=display:flex><span><span style=color:#007020></span>	__u16 len;		<span style=color:#60a0b0;font-style:italic>/* msg length				*/</span>
</span></span><span style=display:flex><span>	__u8 <span style=color:#666>*</span>buf;		<span style=color:#60a0b0;font-style:italic>/* pointer to msg data			*/</span>
</span></span><span style=display:flex><span>};
</span></span></code></pre></td></tr></table></div></div><p>I2C读写驱动例子</p><div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1>  1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-2>  2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-3>  3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-4>  4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-5>  5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-6>  6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-7>  7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-8>  8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-9>  9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-10> 10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-11> 11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-12> 12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-13> 13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-14> 14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-15> 15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-16> 16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-17> 17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-18><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-18> 18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-19><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-19> 19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-20><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-20> 20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-21><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-21> 21</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-22><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-22> 22</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-23><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-23> 23</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-24><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-24> 24</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-25><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-25> 25</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-26><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-26> 26</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-27><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-27> 27</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-28><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-28> 28</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-29><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-29> 29</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-30><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-30> 30</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-31><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-31> 31</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-32><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-32> 32</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-33><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-33> 33</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-34><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-34> 34</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-35><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-35> 35</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-36><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-36> 36</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-37><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-37> 37</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-38><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-38> 38</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-39><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-39> 39</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-40><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-40> 40</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-41><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-41> 41</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-42><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-42> 42</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-43><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-43> 43</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-44><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-44> 44</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-45><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-45> 45</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-46><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-46> 46</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-47><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-47> 47</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-48><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-48> 48</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-49><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-49> 49</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-50><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-50> 50</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-51><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-51> 51</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-52><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-52> 52</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-53><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-53> 53</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-54><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-54> 54</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-55><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-55> 55</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-56><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-56> 56</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-57><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-57> 57</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-58><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-58> 58</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-59><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-59> 59</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-60><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-60> 60</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-61><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-61> 61</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-62><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-62> 62</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-63><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-63> 63</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-64><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-64> 64</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-65><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-65> 65</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-66><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-66> 66</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-67><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-67> 67</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-68><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-68> 68</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-69><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-69> 69</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-70><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-70> 70</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-71><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-71> 71</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-72><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-72> 72</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-73><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-73> 73</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-74><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-74> 74</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-75><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-75> 75</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-76><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-76> 76</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-77><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-77> 77</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-78><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-78> 78</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-79><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-79> 79</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-80><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-80> 80</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-81><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-81> 81</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-82><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-82> 82</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-83><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-83> 83</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-84><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-84> 84</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-85><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-85> 85</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-86><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-86> 86</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-87><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-87> 87</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-88><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-88> 88</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-89><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-89> 89</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-90><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-90> 90</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-91><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-91> 91</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-92><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-92> 92</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-93><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-93> 93</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-94><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-94> 94</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-95><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-95> 95</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-96><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-96> 96</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-97><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-97> 97</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-98><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-98> 98</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-99><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-99> 99</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-100><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-100>100</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-101><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-101>101</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-102><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-102>102</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-103><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-103>103</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-104><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-104>104</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-105><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-105>105</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-106><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-106>106</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-107><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-107>107</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-108><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-108>108</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-109><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-109>109</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-110><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-110>110</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-111><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-111>111</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-112><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-112>112</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-113><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-113>113</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-114><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-114>114</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-115><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-115>115</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-116><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-116>116</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-117><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-117>117</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-118><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-118>118</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-119><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-119>119</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-120><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-120>120</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-121><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-121>121</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-122><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-122>122</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-123><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-123>123</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-124><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-124>124</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-125><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-125>125</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-126><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-126>126</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-127><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-127>127</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-128><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-128>128</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-129><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-129>129</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-130><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-130>130</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-131><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-131>131</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-132><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-132>132</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-133><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-133>133</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-134><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-134>134</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#902000>int</span> <span style=color:#06287e>at24_drv_probe</span>(<span style=color:#007020;font-weight:700>struct</span> i2c_client <span style=color:#666>*</span> client, <span style=color:#007020;font-weight:700>const</span> <span style=color:#007020;font-weight:700>struct</span> i2c_device_id  <span style=color:#666>*</span> id)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#60a0b0;font-style:italic>/*将i2c_bus的match()方法匹配成功时，会将相应的client传递过来，此处保存到全局的设备对象中*/</span>
</span></span><span style=display:flex><span>    at24_dev<span style=color:#666>-&gt;</span>client <span style=color:#666>=</span> client; 
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>//  全局的设备对象
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span><span style=color:#007020;font-weight:700>struct</span> i2c_e2prom{
</span></span><span style=display:flex><span>	<span style=color:#902000>int</span> dev_major;
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> class <span style=color:#666>*</span>cls;
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> device <span style=color:#666>*</span>dev;
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> i2c_client <span style=color:#666>*</span>client;<span style=color:#60a0b0;font-style:italic>//记录当前匹配的client
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>struct</span> i2c_e2prom <span style=color:#666>*</span>at24_dev;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic>//编写一个类似i2c_master_recv/i2c_master_send
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span><span style=color:#902000>int</span> <span style=color:#06287e>at24_i2c_read</span>(<span style=color:#007020;font-weight:700>struct</span> i2c_client <span style=color:#666>*</span>client, <span style=color:#902000>char</span> <span style=color:#666>*</span>buf, <span style=color:#902000>int</span> size)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#902000>int</span> ret;
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> i2c_adapter  <span style=color:#666>*</span>adapter <span style=color:#666>=</span> client<span style=color:#666>-&gt;</span>adapter;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> i2c_msg msg;
</span></span><span style=display:flex><span>	msg.addr <span style=color:#666>=</span> client<span style=color:#666>-&gt;</span>addr;
</span></span><span style=display:flex><span>	msg.flags <span style=color:#666>=</span> I2C_M_RD;
</span></span><span style=display:flex><span>	msg.len <span style=color:#666>=</span> size;
</span></span><span style=display:flex><span>	msg.buf <span style=color:#666>=</span> buf;
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>// 参数1---适配器
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	<span style=color:#60a0b0;font-style:italic>//参数2--消息包
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	<span style=color:#60a0b0;font-style:italic>// 参数3--消息的个数
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	ret <span style=color:#666>=</span> <span style=color:#06287e>i2c_transfer</span>(adapter, <span style=color:#666>&amp;</span>msg, <span style=color:#40a070>1</span>);
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>return</span> ret<span style=color:#666>==</span><span style=color:#40a070>1</span><span style=color:#666>?</span><span style=color:#002070;font-weight:700>size</span>:ret;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#902000>int</span> <span style=color:#06287e>at24_i2c_write</span>(<span style=color:#007020;font-weight:700>struct</span> i2c_client <span style=color:#666>*</span>client, <span style=color:#902000>char</span> <span style=color:#666>*</span>buf, <span style=color:#902000>int</span> size)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#902000>int</span> ret;
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> i2c_adapter  <span style=color:#666>*</span>adapter <span style=color:#666>=</span> client<span style=color:#666>-&gt;</span>adapter;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> i2c_msg msg;
</span></span><span style=display:flex><span>	msg.addr <span style=color:#666>=</span> client<span style=color:#666>-&gt;</span>addr;
</span></span><span style=display:flex><span>	msg.flags <span style=color:#666>=</span> <span style=color:#40a070>0</span>;
</span></span><span style=display:flex><span>	msg.len <span style=color:#666>=</span> size;
</span></span><span style=display:flex><span>	msg.buf <span style=color:#666>=</span> buf;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	ret <span style=color:#666>=</span> <span style=color:#06287e>i2c_transfer</span>(adapter, <span style=color:#666>&amp;</span>msg, <span style=color:#40a070>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>return</span> ret<span style=color:#666>==</span><span style=color:#40a070>1</span><span style=color:#666>?</span><span style=color:#002070;font-weight:700>size</span>:ret;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#902000>int</span> <span style=color:#06287e>at24_i2c_write</span>(<span style=color:#007020;font-weight:700>struct</span> i2c_client <span style=color:#666>*</span>client, <span style=color:#902000>char</span> <span style=color:#666>*</span>buf, <span style=color:#902000>int</span> size)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#902000>int</span> ret;
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> i2c_adapter  <span style=color:#666>*</span>adapter <span style=color:#666>=</span> client<span style=color:#666>-&gt;</span>adapter;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>struct</span> i2c_msg msg;
</span></span><span style=display:flex><span>	msg.addr <span style=color:#666>=</span> client<span style=color:#666>-&gt;</span>addr;
</span></span><span style=display:flex><span>	msg.flags <span style=color:#666>=</span> <span style=color:#40a070>0</span>;
</span></span><span style=display:flex><span>	msg.len <span style=color:#666>=</span> size;
</span></span><span style=display:flex><span>	msg.buf <span style=color:#666>=</span> buf;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	ret <span style=color:#666>=</span> <span style=color:#06287e>i2c_transfer</span>(adapter, <span style=color:#666>&amp;</span>msg, <span style=color:#40a070>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>return</span> ret<span style=color:#666>==</span><span style=color:#40a070>1</span><span style=color:#666>?</span><span style=color:#002070;font-weight:700>size</span>:ret;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#902000>int</span> <span style=color:#06287e>at24_e2prom_drv_open</span> (<span style=color:#007020;font-weight:700>struct</span> inode <span style=color:#666>*</span>inode, <span style=color:#007020;font-weight:700>struct</span> file <span style=color:#666>*</span>filp)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>return</span> <span style=color:#40a070>0</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#902000>ssize_t</span> <span style=color:#06287e>at24_e2prom_drv_read</span>(<span style=color:#007020;font-weight:700>struct</span> file <span style=color:#666>*</span>filp, <span style=color:#902000>char</span> __user <span style=color:#666>*</span>buf, <span style=color:#902000>size_t</span> count, <span style=color:#902000>loff_t</span> <span style=color:#666>*</span>fpos)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#902000>int</span> ret;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>if</span>(count <span style=color:#666>&lt;</span> <span style=color:#40a070>0</span> <span style=color:#666>||</span> count <span style=color:#666>&gt;</span> <span style=color:#40a070>256</span>)
</span></span><span style=display:flex><span>		<span style=color:#007020;font-weight:700>return</span> <span style=color:#666>-</span>EINVAL;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#902000>char</span> <span style=color:#666>*</span>tmp <span style=color:#666>=</span> <span style=color:#06287e>kzalloc</span>(count, GFP_KERNEL);
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>// 1, 从硬件中获取数据
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	ret <span style=color:#666>=</span> <span style=color:#06287e>at24_i2c_read</span>(at24_dev<span style=color:#666>-&gt;</span>client, tmp, count);
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>if</span>(ret <span style=color:#666>&lt;</span> <span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#06287e>printk</span>(<span style=color:#4070a0>&#34;at24_i2c_read error</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#007020;font-weight:700>goto</span> err_free;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>// 2 ,将数据给用户
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	ret <span style=color:#666>=</span> <span style=color:#06287e>copy_to_user</span>(buf, tmp, count);
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>if</span>(ret <span style=color:#666>&gt;</span> <span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#06287e>printk</span>(<span style=color:#4070a0>&#34;copy_to_user error</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#007020;font-weight:700>goto</span> err_free;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span><span style=color:#002070;font-weight:700>err_free</span>:
</span></span><span style=display:flex><span>	<span style=color:#06287e>kfree</span>(tmp);
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>return</span> ret;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#902000>ssize_t</span> <span style=color:#06287e>at24_e2prom_drv_write</span>(<span style=color:#007020;font-weight:700>struct</span> file <span style=color:#666>*</span>filp, <span style=color:#007020;font-weight:700>const</span> <span style=color:#902000>char</span> __user <span style=color:#666>*</span>buf, <span style=color:#902000>size_t</span> count, <span style=color:#902000>loff_t</span> <span style=color:#666>*</span>fpos)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#06287e>printk</span>(<span style=color:#4070a0>&#34;-----------%s-----------</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#34;</span>, __FUNCTION__);
</span></span><span style=display:flex><span>	<span style=color:#902000>int</span> ret;
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>if</span>(count <span style=color:#666>&lt;</span> <span style=color:#40a070>0</span> <span style=color:#666>||</span> count <span style=color:#666>&gt;</span> <span style=color:#40a070>256</span>)
</span></span><span style=display:flex><span>		<span style=color:#007020;font-weight:700>return</span> <span style=color:#666>-</span>EINVAL;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#902000>char</span> <span style=color:#666>*</span>tmp <span style=color:#666>=</span> <span style=color:#06287e>kzalloc</span>(count, GFP_KERNEL);
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>// 1, 从用户空间将数据获取到
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	ret <span style=color:#666>=</span> <span style=color:#06287e>copy_from_user</span>(tmp, buf, count);
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>if</span>(ret <span style=color:#666>&gt;</span> <span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#06287e>printk</span>(<span style=color:#4070a0>&#34;copy_from_user error</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#007020;font-weight:700>goto</span> err_free;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>// 2,  将数据写入硬件中去
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	ret <span style=color:#666>=</span> <span style=color:#06287e>at24_i2c_write</span>(at24_dev<span style=color:#666>-&gt;</span>client, tmp, count);
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>if</span>(ret <span style=color:#666>&lt;</span> <span style=color:#40a070>0</span>)
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#06287e>printk</span>(<span style=color:#4070a0>&#34;at24_i2c_write error</span><span style=color:#4070a0;font-weight:700>\n</span><span style=color:#4070a0>&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#007020;font-weight:700>goto</span> err_free;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span><span style=color:#002070;font-weight:700>err_free</span>:
</span></span><span style=display:flex><span>	<span style=color:#06287e>kfree</span>(tmp);
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>return</span> ret;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>Yuanye Ma</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2020-10-05</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a href=https://github.com/gohugoio/hugoBasicExample rel=noopener target=_blank>See origin</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/kernel-driver/>Kernel driver</a>
<a href=/tags/i2c%E5%AD%90%E7%B3%BB%E7%BB%9F/>i2c子系统</a></div><nav class=post-nav><a class=prev href=/post/os/linux-kernel/%E5%85%B3%E4%BA%8E%E8%AE%BE%E5%A4%87%E6%A0%91/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg>
</i><span class="prev-text nav-default">Linux设备树</span>
<span class="prev-text nav-mobile">Prev</span>
</a><a class=next href=/post/os/linux-kernel/2020-10-06-platform%E6%80%BB%E7%BA%BF%E9%A9%B1%E5%8A%A8/><span class="next-text nav-default">platform总线驱动</span>
<span class="prev-text nav-mobile">Next</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=icon-links><a href=yuanye.ma@qq.com rel="me noopener" class=iconfont title=email target=_blank><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg>
</a><a href=https://github.com/YuanyeMa rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" style="" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg>
</a><a href=https://www.zhihu.com/people/mr-kevin-92/posts rel="me noopener" class=iconfont title=zhihu target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M351.791182 562.469462h192.945407c0-45.367257-21.3871-71.939449-21.3871-71.939449L355.897709 490.530013c3.977591-82.182744 7.541767-187.659007 8.816806-226.835262h159.282726s-.86367-67.402109-18.578124-67.402109-279.979646.0-279.979646.0 16.850783-88.141456 39.318494-127.053698c0 0-83.60514-4.510734-112.121614 106.962104S81.344656 355.077018 76.80834 367.390461s24.62791 5.832845 36.941354.0c12.313443-5.832845 68.050885-25.924439 84.252893-103.69571h86.570681c1.165546 49.28652 4.596691 200.335724 3.515057 226.835262H109.86113c-25.275663 18.147312-33.701566 71.939449-33.701566 71.939449H279.868105c-8.497535 56.255235-23.417339 128.763642-44.275389 167.210279-33.05279 60.921511-50.55235 116.65793-169.802314 212.576513.0.0-19.442818 14.257725 40.829917 9.073656 60.273758-5.185093 117.305683-20.739347 156.840094-99.807147 20.553105-41.107233 41.805128-93.250824 58.386782-146.138358l-.055259.185218 167.855986 193.263655s22.035876-51.847855 5.832845-108.880803L371.045711 650.610918l-42.1244 31.157627-.045025.151449c11.69946-41.020252 20.11206-81.5749 22.726607-116.858498C351.665315 564.212152 351.72876 563.345412 351.791182 562.469462z"/><path d="M584.918753 182.033893v668.840094h70.318532l28.807093 80.512708 121.875768-80.512708h153.600307L959.520453 182.033893h-374.6017zM887.150192 778.934538h-79.837326l-99.578949 65.782216-23.537066-65.782216h-24.855084L659.341766 256.673847h227.807403V778.934538z"/></svg>
</a><a href="https://space.bilibili.com/159072924?spm_id_from=333.1007.0.0" rel="me noopener" class=iconfont title=bilibili target=_blank><svg class="icon" style="" viewBox="0 0 1024 1024" width="36" height="36" id="svg8"><path style="" d="M744.60599.00486267A41.779915 41.779915.0 00710.4184 18.673394L548.5048 255.32642h-11.70046a41.779915 41.779915.0 00-10.80295-7.84928L235.66 97.084498a41.779915 41.779915.0 00-20.07193-4.960864 41.779915 41.779915.0 00-18.3748 79.145436L359.4859 255.32642H128.16909c-49.458302.0-89.27932 39.82105-89.27932 89.27932v508.65224c0 49.4583 39.821018 89.27934 89.27932 89.27934h19.48445C149.12802 984.5043 179.92773 1024 224.79179 1024c44.86407.0 75.66379-39.4957 77.13826-81.46268H719.98116C721.45559 984.5043 752.25533 1024 797.1194 1024c44.86406.0 75.6638-39.4957 77.13824-81.46268h21.57323c49.45831.0 89.27936-39.82104 89.27936-89.27934V344.60574c0-49.45827-39.82105-89.27932-89.27936-89.27932H649.74567L779.38103 65.866924A41.779915 41.779915.0 00744.60599.00486267zM644.49108 418.70871c6.29985.21538 12.44451 2.01107 17.86888 5.22196l171.36218 98.10771c18.23417 10.21935 24.63334 33.34627 14.24614 51.48533-10.38726 18.13909-33.57344 24.32718-51.61587 13.77296L624.9903 489.18895c-15.21356-8.41858-22.66871-26.1765-18.03211-42.93436 4.63664-16.75784 20.15573-28.14465 37.53289-27.54588zM350.2006 432.31846c16.89952.0317 31.69582 11.33328 36.17844 27.62747 4.48262 16.2942-2.44981 33.57765-16.95507 42.24898l-140.7157 86.91312c-17.68528 11.18244-41.09629 5.77692-52.08912-12.02686-10.99282-17.80373-5.33855-41.15658 12.58167-51.95857L329.9002 438.2095c6.0643-3.86439 13.10951-5.90891 20.3004-5.89104zM501.605 641.53985c3.75002-.15248 7.48645.53903 10.93349 2.0235.15842.0637.31618.12888.47325.19582.59328.27092 1.17574.56489 1.74609.88121.15868.0854.31643.17233.47325.2611.55694.32165 1.10131.66458 1.63185 1.02807.16455.1123.32777.2265.48956.34269.50382.36781.99371.75428 1.46868 1.15864.18724.15504.37218.31282.55484.47323.43271.38784.8518.79061 1.25653 1.20756.15449.16114.30679.32437.45693.48959.40798.44266.79989.89988 1.17494 1.37076.17799.22544.35205.45395.5222.68538.25932.34701.50964.70071.75064 1.06071.26712.39516.52286.79784.76699 1.20757.16907.29043.33231.58424.48957.88123.21836.41297.42513.83199.62009 1.25653.14836.32333.28983.64976.42429.97911.21319.51552.40915 1.03801.58747 1.5666.0677.19499.13296.39085.19582.58748.18652.60823.34984 1.22334.48957 1.84399.0397.16277.0779.32601.11423.48957.1436.69112.25788 1.38801.34269 2.08877.005.0381.0111.0761.0163.11424.0857.78056.13474 1.56471.14687 2.34988.005.0543.0111.10879.0163.1632.0.0-.008 1.12132.0 1.45234.0.0-.14697 17.84761 5.89102 34.12231 3.01902 8.13734 7.33278 15.10615 12.61433 19.61501 5.28157 4.50889 11.42894 7.62081 23.64572 7.62081 12.2168.0 18.36416-3.11192 23.64573-7.62081 5.28154-4.50886 9.5953-11.47767 12.6143-19.61501 6.03799-16.2747 5.89103-34.12231 5.89103-34.12231-.44885-13.87045 10.45922-25.46302 24.3311-25.86506 13.87189-.40201 25.42828 10.53953 25.78348 24.41272.0.0 1.11929 25.7226-9.00791 53.01927-5.06359 13.64832-13.1986 28.46036-27.05631 40.29073-13.85772 11.83039-33.5454 19.63135-56.20142 19.63135-22.65603.0-42.34371-7.80096-56.20141-19.63135-4.1801-3.56856-7.78733-7.42433-10.99878-11.42303-3.21235 4.00037-6.81703 7.85309-10.99876 11.42303-13.85773 11.83039-33.5454 19.63135-56.20144 19.63135-22.65601.0-42.3437-7.80096-56.2014-19.63135-13.85775-11.83037-21.99272-26.64241-27.05632-40.29073-10.12725-27.29667-9.00789-53.01928-9.00789-53.01927.20714-13.83687 11.58744-24.88848 25.42444-24.69013 14.1263.19991 25.2971 12.0278 24.69011 26.14247.0.0-.14697 17.84761 5.89103 34.12231 3.01902 8.13734 7.31646 15.10615 12.598 19.61501 5.28155 4.50889 11.44526 7.62081 23.66203 7.62081 12.21681.0 18.36418-3.11192 23.64573-7.62081 5.28154-4.50886 9.57899-11.47767 12.598-19.61501 5.76352-15.53489 5.89112-32.05691 5.89103-33.56746.006-.37466.0111-1.05336.0163-1.20759-.0117-.74583.0105-1.49177.0652-2.23565.009-.15784.0204-.31561.0327-.47324.14204-1.56859.43163-3.12027.86487-4.63449.0213-.0763.0433-.15244.0652-.22848 3.0335-10.25748 12.24157-17.46007 22.92769-17.93417z" id="rect824"/></svg>
</a><a href=/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span><span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a>
</span><span class=copyright-year>&copy;
2024
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg>
</i></span><span class=author>Yuanye Ma</span></span></div></footer><div class=button__back-to-top><a href=#back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></a></div></div><script type=text/javascript src=/lib/jquery/jquery-3.7.1.min.js></script><script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script><script type=text/javascript src=/js/main.1f1ab71292e8ae0addbb90a5827f619e1cc7eba4a57b08930f33e5d8700d84be.js integrity="sha256-Hxq3EpLorgrdu5Clgn9hnhzH66SlewiTDzPl2HANhL4=" crossorigin=anonymous></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script></body></html>